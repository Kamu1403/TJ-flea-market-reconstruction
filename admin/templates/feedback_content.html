{% extends "base.html" %} {% block title %}
<title>反馈详情</title>
{% endblock %} {% block css %} {{ super() }} {% endblock %} {% block header %} {{ super() }} {% endblock %} {% block main %}
<main>
    <section class="shop--area shop-right-sidebar pt-90 pb-90">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-3">{% include "cont_side.html" %}</div>
                <div class="col-9" id="testt"></div>
            </div>
        </div>
    </section>
</main>
{% endblock %} {% block footer %} {{ super() }} {% endblock %} {% block js %} {{ super() }}

<script type="text/javascript" charset="utf-8">
    var feedback_id = "{{ feedback_id|safe }}"; // 如果有python传过来的
    var debug = 0;
    $(document).ready(function () {
        let url = "/api/admin_get_report";
        if (debug) url = `http://127.0.0.1:4523/mock/927026${url}`;
        $.ajax({
            // json形式
            url: url,
            type: "get",
            data: { feedback_id: feedback_id },
            success: function (ret) {
                let main = $(testt);

                //console.log(ret.data);
                kind2str = { 0: "举报用户", 1: "举报物品", 2: "反馈网站bug", 3: "个人提问", 4: "交易维权", 5: "其他" };
                state2str = { 0: "未读 | 未回复", 1: "已读 | 未回复", "-1": "已读 | 已回复" };
                main.append(`
                    <p>反馈用户ID：${ret.data.user_id}</p>
                    <p>反馈类型：${kind2str[ret.data.kind]}</p>
                    <p>反馈时间：${ret.data.publish_time}</p>
                    <p>反馈内容：${ret.data.feedback_content}</p>
                    <p>反馈状态：${state2str[ret.data.state]}</p>
                `);
                if (ret.data.state == -1) main.append(`<p>回复内容：${ret.data.reply_content}</p>`);

                main.append(`<textarea placeholder="请输入回复..."></textarea>`);
                main.append("<br /><a href='#' class='btn'>回复反馈</a>");
                let reply = main.children().eq(-2);
                let submit = main.children().eq(-1);
                submit.click(function () {
                    let reply_url = "/api/reply_feedback";
                    if (debug) reply_url = `http://127.0.0.1:4523/mock/927026${reply_url}`;
                    $.ajax({
                        url: reply_url,
                        type: "put",
                        data: JSON.stringify({ feedback_id: feedback_id, reply_content: reply.val() }),
                        contentType: "application/json;charset=utf-8",
                        processData: false,
                        success: function (reply_ret) {
                            suspend("alert-success", "回复成功: " + ret.message);
                            sleep(500).then(() => {
                                window.location.href = "{{url_for('admin.feedback_show')}}";
                            });
                        },
                    });
                });
            },
        });
    });
</script>

{% endblock %}
