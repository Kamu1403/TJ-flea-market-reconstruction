{% extends "base.html" %} {% block title %}
<title>同济大学跳蚤市场--搜索结果</title>
{% endblock %} {% block css %} {{ super() }} {% endblock %} {% block header %} {{ super() }} {% endblock %} {% block
main %}
<main>
    <!-- shop-area -->
    <section class="shop--area pt-90 pb-90">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-9">
                    <div class="shop-top-meta mb-30">
                        <div class="row">
                            <div class="col-md-6 col-sm-7">
                                <div class="shop-top-left">
                                    <!--
                                    <ul>
                                        <li>
                                            <a href="#"><i class="fas fa-bars"></i> FILTER</a>
                                        </li>
                                    </ul>
                                -->
                                    <select class="form-control" name="tag" onchange="test()">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-5">
                                <div class="shop-top-right">
                                    <form action="#">
                                        <select name="select">
                                            <option value="">Sort by newness</option>
                                            <option>Free Shipping</option>
                                            <option>Best Match</option>
                                            <option>Newest Item</option>
                                            <option>Size A - Z</option>
                                        </select>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="shop-products-wrap">
                        <div id="display" class="row justify-content-center"></div>
                    </div>
                    <div class="pagination-wrap">
                        <ul>
                            <li class="prev"><a href="shop.html">Prev</a></li>
                            <li class="active"><a href="shop.html">1</a></li>
                            <li><a href="shop.html">2</a></li>
                            <li><a href="shop.html">3</a></li>
                            <li><a href="shop.html">4</a></li>
                            <li><a href="shop.html">...</a></li>
                            <li><a href="shop.html">10</a></li>
                            <li class="next"><a href="shop.html">Next</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- shop-area-end -->
</main>

{% endblock %} {% block footer %} {{ super() }} {% endblock %} {% block js %} {{ super() }}
<script type="text/javascript" charset="utf-8">
    var keyword = "{{ keyword|safe }}";
    var search_type = "{{ search_type|safe }}";
    function send_search(data) {
        $.ajax({
            url: "/api/search",
            type: "post",
            data: JSON.stringify(data),
            contentType: "application/json;charset=utf-8",
            processData: false,
            success: function (ret) {
                if (ret.statusCode == 400) {
                    console.log(ret.message);
                } else {
                    $("#display").children().remove();
                    var items = ret.data;
                    for (let i = 0; i < items.length; i++) {
                        let item = items[i];
                        let id = item.id;
                        let name = item.name;
                        let price = item.price;
                        let time = item.publish_time;
                        let purl = "";
                        $.ajax({
                            url: "/api/get_item_head_pic",
                            async: false,
                            data: { item_id: id },
                            type: "get",
                            success: function (ret) {
                                purl = ret.data.url;
                            },
                        });
                        let str = `<div class="col-xl-3 col-md-4 col-sm-6">
                                <div class="sp-product-item">
                                    <div class="sp-product-thumb">
                                        <span class="batch">New</span>
                                        <a href="/item/content/${id}">
                                            <img src="${purl}" alt=""></a>
                                    </div>
                                    <div class="sp-product-content">
                                        <h6 class="title">
                                            <a href="/item/content/${id}">${name}</a>
                                        </h6>
                                        <p>单价:${price}
                                        </p>
                                    </div>
                                </div>
                            </div>`;
                        $("#display").append(str);
                    }
                }
            },
        });
    }
    function test() {
        var data = { search_type: search_type, start_time: "", end_time: "", order_type: "", key_word: keyword };
        if ($(".form-control[name='tag']").val() != "all") {
            data["tag"] = $(".form-control[name='tag']").val();
        }
        send_search(data);
    }


    $(document).ready(function () {
        send_search({ search_type: search_type, start_time: "", end_time: "", order_type: "", key_word: keyword });
        $.ajax({
            url: "/api/get_class",
            type: "get",
            success: function (class_ret) {
                $(".form-control[name='tag']").append(`<option selected='selected'>all</option>`);
                for (var i = 0; i < class_ret.data.class.length; i++) {
                    $(".form-control[name='tag']").append(`<option value='${class_ret.data.class[i]}'>\
                        ${class_ret.data.class[i]}</option>`);
                }
            }
        })
    });
</script>
{% endblock %}