var SFE=SFE||{};SFE.search={};SFE.search=(function($){var searchFlag=true;var tempkeyArray=new Array();var d=function(b){var a;return(a=document.cookie.match(RegExp("(^| )"+b+"=([^;]*)(;|$)")))?decodeURIComponent(a[2].replace(/\+/g,"%20")):null};var snbookHotWord=function(){$.ajax({url:sn.searchDomain+"web/allHotWord.jsonp",cache:false,dataType:"jsonp",jsonp:"callback",jsonpCallback:"AllHWord",success:function(data){var _str="";var hotWords=data.hotWords;for(var i=0;i<6&&i<hotWords.length;i++){var _value=hotWords[i];var _href=sn.searchDomain+"web/search.do?keywords="+encodeURIComponent(resolveStr(_value));_str+='<a href="'+_href+'" target="_blank" name="public0_RSC_'+_value+"_"+i+'">';if(i<3){_str+='<font style="color:#FF6600">'+_value+"</font>"}else{_str+=_value}_str+="</a>"}var _html=$("#snKeywordNew").html()+_str;$("#snKeywordNew").html(_html)}})};var dsservice=function(){var ego_pre=/^(\w*)(pre)(\w*)(.cnsuning.com)$/;var ego_sit=/^(\w*)(sit)(\w*)(.cnsuning.com)$/;var ego_dev=/^(\w*)(dev)(\w*)(.cnsuning.com)$/;var _hostName=document.location.hostname;var dsservice="http://ds.suning.cn/ds/";if(ego_pre.test(_hostName)){dsservice="http://dspre.cnsuning.com/ds/"}else{if(ego_sit.test(_hostName)){dsservice="http://dssit.cnsuning.com/ds/"}else{if(ego_dev.test(_hostName)){dsservice="http://dspre.cnsuning.com/ds/"}}}return dsservice};var getSearchKeyword=function(){if($("#searchKeywords").size()==0){return false}var channelName=$("#g_static_channel_name").val();if(channelName=="snbook"){var searchKeywordsHidden=$("#searchKeywordsHidden").val();if(typeof searchKeywordsHidden!="undefined"&&searchKeywordsHidden!=""){$("#searchKeywords").val(searchKeywordsHidden);$("#snKeywordNew").html('<input type="hidden" id="searchDefaultKeyword" value="'+searchKeywordsHidden+'">')}else{$.ajax({url:sn.searchDomain+"web/hotkeywords.jsonp",cache:false,dataType:"jsonp",jsonp:"callback",jsonpCallback:"HWord",success:function(data){$("#searchKeywords").val(data.hotWords);var _html=$("#snKeywordNew").html()+'<input type="hidden" id="searchDefaultKeyword" value="'+data.hotWords+'">';$("#snKeywordNew").html(_html)}})}snbookHotWord();return false}var daMain=dsservice()+"hotkeywords/";$.ajax({url:daMain+getCategoryId()+"--showHotkeywords"+".xjsonp",type:"get",dataType:"jsonp",jsonpCallback:"showHotkeywords",success:function(data){try{var html=data.html.replace(/\{cityId}/g,d("cityId"));$("#snKeywordNew").html(html);searchFlag=true;var searchKeywordsHidden=$("#searchKeywordsHidden").val();if(typeof searchKeywordsHidden!="undefined"&&searchKeywordsHidden!=""){$("#searchKeywords").val(searchKeywordsHidden)}else{if($("#searchKeywords").val()==""&&document.activeElement.id!="searchKeywords"){var searchDefaultKeyword=$("#searchDefaultKeyword").val();if(searchDefaultKeyword!=""){$("#searchKeywords").val(searchDefaultKeyword)}else{$("#searchKeywords").val("输入关键字搜索商品/品牌/店铺")}searchFlag=false}}}catch(e){}}})};var searchInputEvent=function(){if($("#searchSubmit").size()==0){return false}$("#searchSubmit").hover(function(){$(this).addClass("search-btn-hover")},function(){$(this).removeClass("search-btn-hover")});var obj=$("#searchKeywords");obj.focus(function(){obj.parents(".g-search").addClass("g-search-focus");var value=$(this).val(),searchDefaultKeyword=$("#searchDefaultKeyword").val()||"";if(value==searchDefaultKeyword||value=="输入关键字搜索商品/品牌/店铺"){obj.val("").css({color:"#000"})}outerAction()}).blur(function(){obj.parents(".g-search").removeClass("g-search-focus");var value=$.trim($(this).val()),searchDefaultKeyword=$("#searchDefaultKeyword").val()||"";if(searchDefaultKeyword==""){searchDefaultKeyword="输入关键字搜索商品/品牌/店铺"}searchFlag=true;if(value==""){searchFlag=false;obj.val(searchDefaultKeyword).css({color:"#CCC"})}})};var searchHotkeywords=function(){var channelName=$("#g_static_channel_name").val();if(channelName=="snbook"){return false}var searchHot=$("#rec_results .rec-results");if(searchHot.html()!=""){return}var daMain=dsservice()+"searchHotkeywords/";$.ajax({url:daMain+getCategoryId()+"-searchHotkeywords"+".jsonp",type:"get",dataType:"jsonp",cache:true,jsonpCallback:"searchHotkeywords",success:function(data){var dom='<li class="title"><span>正在热搜中</span> <i class="close ng-iconfont">&#xe627;</i></li>';var index_num=0;$(data).each(function(){var url=setUrl(this.keyword);var length=34;if($("body").hasClass("root1000")){length=22}var tempkey=cutString(this.keyword,length);var titlekey="";var namekey=this.keyword;var dirId=this.dirId;if(tempkey!=this.keyword){titlekey=this.keyword}dom+="<li>"+'<a id="public0_zzrs_'+namekey+"_"+index_num+"-"+dirId+'"  name="public0_zzrs_'+namekey+"_"+index_num+"-"+dirId+'" target="_blank" href="'+url+'" title="'+titlekey+'">'+tempkey+"</a>"+"</li>";index_num++});searchHot.html(dom);var rec=$("#rec_results");rec.find(".title").find(".close").each(function(){$(this).click(function(){rec.hide()})})},error:function(){}})};var searchHisKeyword=function(){var channelName=$("#g_static_channel_name").val();if(channelName=="snbook"){return false
}var searchHis=$("#rec_results .history-results");var userId=d("custno")||"";var domTemp='<li class="title gray"><span>最近搜索</span></li><li> <i class="search-express-none"></i></li>';if(userId==""){searchHis.html(domTemp);return}searchHisEvent();var daMain=dsservice();$.ajax({url:daMain+"his/"+userId+"---searchHis.jsonp",dataType:"jsonp",jsonpCallback:"searchHis",success:function(data){if($(data.words).size()<=0){searchHis.html(domTemp);return}else{var dom='<li class="title"><span>最近搜索</span>'+'<a href="javascript:void(0)" class="clear-history"><i class="ng-iconfont">&#xe62d;</i>清空</a></li>';$(data.words).each(function(key,value){if(typeof value.type!="undefined"&&value.type==="his"){var _tempkey=value.keyname;if($("body").hasClass("root1000")){_tempkey=cutString(_tempkey,22)}var _title=value.keyname.replace(/\"/g,"&quot;");_tempkey=_tempkey.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;");dom+='<li class="active"><span><a title="'+_title+'">'+_tempkey+'</a><i class="ng-iconfont">&#xe62d;</i></span></li>'}});searchHis.html(dom);$(".clear-history").click(function(){var e=e||window.event||arguments.callee.caller.arguments[0];if(e&&e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}var userId=d("custno")||"";var daMain=dsservice();var url=daMain+"his/clean/"+userId+"-0.jsonp";httpGifSendIndex(url);tempkeyArray=new Array();searchHis.find("li").not(".title").find("a").each(function(){tempkeyArray.push($(this).text())});searchHis.html('<li class="title gray"><span>您的历史记录已经被清空</span><a class="cancel-btn" onclick="SFE.search.cancelbtnEvent()">撤销</a></li><li><i class="search-express-none"></i></li>')})}},error:function(){searchHis.html(domTemp)}})};var searchHisEvent=function(){var searchHis=$("#rec_results .history-results");searchHis.delegate(".active","mouseover",function(){$(this).addClass("rec_over").siblings().removeClass("rec_over")}).delegate(".active","click",function(){searchFlag=true;var flag=false;var e=e||window.event||arguments.callee.caller.arguments[0];var target=e.target||e.srcElement;if(target.tagName=="I"){flag=true;if(e&&e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}if(flag){deleteHisKey($(this).find("span a").attr("title"));$(this).remove()}else{var obj=$("#searchKeywords");obj.val($(this).find("span a").attr("title"));$("#rec_results").hide();$("#searchSubmit").click()}})};var cancelbtnEvent=function(){var e=e||window.event||arguments.callee.caller.arguments[0];if(e&&e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}var searchHis=$("#rec_results .history-results");var userId=d("custno")||"";var domTemp='<li class="title gray"><span>最近搜索</span></li><li> <i class="search-express-none"></i></li>';if(userId==""){searchHis.html(domTemp);return}var length=tempkeyArray.length;var daMain=dsservice();var _str="";searchHisEvent();var dom='<li class="title"><span>最近搜索</span>'+'<a href="javascript:void(0)" class="clear-history"><i class="ng-iconfont">&#xe62d;</i>清空</a></li>';$(tempkeyArray).each(function(){_str+=encodeURIComponent(this)+"~";var _tempkey=this;if($("body").hasClass("root1000")){_tempkey=cutString(_tempkey,22)}dom+='<li class="active"><span><a title="'+this+'">'+_tempkey+'</a><i class="ng-iconfont">&#xe62d;</i></span></li>'});searchHis.html(dom);$(".clear-history").click(function(){var e=e||window.event||arguments.callee.caller.arguments[0];if(e&&e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}var userId=d("custno")||"";var daMain=dsservice();var url=daMain+"his/clean/"+userId+"-0.jsonp";httpGifSendIndex(url);tempkeyArray=new Array();searchHis.find("li").not(".title").find("a").each(function(){tempkeyArray.push($(this).text())});searchHis.html('<li class="title gray"><span>您的历史记录已经被清空</span><a class="cancel-btn" onclick="SFE.search.cancelbtnEvent()">撤销</a></li><li><i class="search-express-none"></i></li>')});if(_str.length>0){_str=_str.substring(0,_str.length-1)}var url=daMain+"his/add/"+userId+"-"+_str+"-0.jsonp";httpGifSendIndex(url)};var deleteHisKey=function(key){var userId=d("custno")||"";var daMain=dsservice();var url=daMain+"his/del/"+userId+"-"+encodeURIComponent(key)+"-delsearchHis.jsonp";httpGifSendIndex(url)};var searchCatalogId=false;var searchStoreFlag=false;var search_da_djc_index=-1;var ismanual=0;var nameType="";var assWord="";var apsClickUrl="";var searchAutoComplete=function(){if($("#searchKeywords").size()==0){return false}var channelName=$("#g_static_channel_name").val();if(channelName=="snbook"){return false}var isIE6=!!window.ActiveXObject&&!window.XMLHttpRequest;var obj=$("#searchKeywords");var delay=200,timer,resultBox=$("#ac_results");var rec_results=$("#rec_results");if(resultBox.size()==0){$('<div class="g-ac-results" id="ac_results" style="display:none;"></div>').appendTo(".g-search");resultBox=$("#ac_results")}resultBox.delegate("li","mouseover",function(){if($(this).find(".action").length>0){$(this).find(".action").show();$(this).find(".tip").hide()}$(this).addClass("ac_over").siblings().removeClass("ac_over")
}).delegate("li","mouseout",function(){if($(this).find(".action").length>0){$(this).find(".action").hide();$(this).find(".tip").show()}}).delegate("li","click",function(){ismanual=$(this).attr("isManual");search_da_djc_index=$(this).attr("indexnum");nameType=$(this).attr("name");assWord=$(this).attr("assword");apsClickUrl=$(this).attr("apsClickUrl");searchFlag=true;var flag=false;var e=e||window.event||arguments.callee.caller.arguments[0];var target=e.target||e.srcElement;if($(target).hasClass("action")){flag=true;if(e&&e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}if(flag){deleteHisKey($(this).find(".keyparam").text());$(this).remove()}else{if($(this).attr("categoryid")!=""&&$(this).attr("categoryid")!="undefined"&&$(this).attr("categoryid")!=null){searchCatalogId=$(this).attr("categoryid")}else{searchCatalogId=false}if($(this).hasClass("g-ac-store")){searchStoreFlag=true}else{searchStoreFlag=false}resultListCurrentIndex=-1;if(nameType!="brandshop"){obj.val($(this).find(".keyparam").text());resultBox.hide()}$("#searchSubmit").click()}});var resultListCurrentIndex=-1;var selectKeywordByKey=function(n){var resultBox=$("#ac_results"),results=resultBox.find("li"),maxCount=results.size();if(resultBox.is("hidden")||results.size()==0||Math.abs(n)!=1){return}resultListCurrentIndex+=n;if(resultListCurrentIndex<0){resultListCurrentIndex=maxCount-1}if(resultListCurrentIndex==maxCount){resultListCurrentIndex=0}var currentKeywords=results.eq(resultListCurrentIndex);ismanual=$(currentKeywords).attr("isManual");search_da_djc_index=$(currentKeywords).attr("indexnum");nameType=$(currentKeywords).attr("name");assWord=$(currentKeywords).attr("assword");apsClickUrl=$(currentKeywords).attr("apsClickUrl");results.removeClass("ac_over");currentKeywords.addClass("ac_over");if(currentKeywords.attr("categoryid")){searchCatalogId=currentKeywords.attr("categoryid")}else{searchCatalogId=false}if(currentKeywords.hasClass("g-ac-store")){searchStoreFlag=true}else{searchStoreFlag=false}obj.val(currentKeywords.find(".keyparam").text());return false};var autoComplateFun=function(keyword){clearTimeout(timer);timer=setTimeout(function(){$("#rec_results").hide();var userId=d("custno")||"";if(keyword.length==0){$("#rec_results").show();searchHisKeyword();searchHotkeywords();resultBox.hide();return false}var daMain=dsservice();$.ajax({url:daMain+"newhis/"+userId+"-"+encodeURIComponent(resolveHisKey(keyword))+"-"+getSearchCategoryId()+"-1-autoComplateCallback.jsonp",dataType:"jsonp",jsonpCallback:"autoComplateCallback",success:function(data){resultBox.show();var resultDom='<i class="close ng-iconfont">&#xe627;</i><ul>';var i=1;var hisi=1;var n=1;var searchboxBanner=data.searchboxBanner;if(searchboxBanner&&searchboxBanner.image&&searchboxBanner.url){resultDom+='<li class="input-ad"><a name="public0_RSC-05_'+keyword+'_1" target="_blank" href='+searchboxBanner.url+' class="input-ad-link"><img src='+searchboxBanner.image+' alt="" width="260" height="26"></a></li>'}var brandShop=data.brandShop;if(brandShop&&brandShop.shopName&&brandShop.apsClickUrl&&brandShop.shopLogo){resultDom+='<li class="g-ac-rec-store" assword='+brandShop.shopName+' apsClickUrl="'+brandShop.apsClickUrl+'"  name="brandshop" >'+'<a href="'+brandShop.apsClickUrl+'" target="_blank" class="store-link"><img src="'+brandShop.shopLogo+'" alt="" width="90" height="30"><em class="store-name">'+brandShop.shopName+'</em><i class="ng-iconfont arrow-r"></i></a><span style="display:none;"  class="keyparam">'+brandShop.shopName+"</span></li>"}$(data.words).each(function(key,value){if(typeof value.categoryName!="undefined"){resultDom+="<li  assword="+value.categoryName+' name="category" indexnum="'+i+++'"  ismanual= "'+value.isManual+'"  categoryid="'+value.categoryId+'" class="cateSearch">在<b>'+value.categoryName+'</b>分类 中搜索<span style="display:none;" class="keyparam">'+value.keyname+"</span></li>"}else{if(typeof value.type!="undefined"&&value.type==="his"){var _tempkey=value.keyname.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;");resultDom+="<li assword="+_tempkey+'  name="history" indexnum="'+hisi+++'"><span class="history">'+_tempkey+'</span><span style="display:none;"  class="keyparam">'+_tempkey+'</span><i class="tip">搜索历史</i><i class="ng-iconfont action">&#xe62d;</i></li>'}else{if(n<=8){resultDom+="<li assword="+value.keyname.replace(/<[^>]+>/g,"")+' name="hotword" indexnum="'+i+'" ismanual= "'+value.isManual+'" ><span class="keyname">'+value.keyname+'</span><span style="display:none;"  class="keyparam">'+value.keyname+"</span></li>";i++;n++}}}});var keywordShow=cutString(keyword,22);keywordShow=keywordShow.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");keyword=keyword.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");resultDom+="<li assword="+keywordShow+'   name="store" indexnum="1" class="g-ac-store"><i class="icon-store"></i>找“<em>'+keywordShow+'</em>”相关<b>店铺</b><span style="display:none;" class="keyparam">'+keyword+"</span></li>";resultDom+="</ul>";resultBox.html(resultDom);
resultBox.find(".cateSearch:last").addClass("bottom");resultListCurrentIndex=-1}})},delay)};obj.keyup(function(event){searchFlag=true;if(event.which==13||event.which==38||event.which==40){return false}var keyword=$.trim($("#searchKeywords").val());keyword=CtoH(keyword);autoComplateFun(keyword)}).keydown(function(event){if(event.which==13){resultBox.hide();resultListCurrentIndex=-1;$("#searchSubmit").click();return false}if(event.which==38){selectKeywordByKey(-1)}if(event.which==40){selectKeywordByKey(1)}}).click(function(){searchFlag=true;var keyword=$.trim($("#searchKeywords").val());if(keyword.length==0){$("#rec_results").show();searchHisKeyword();searchHotkeywords()}else{var keyword=$.trim($("#searchKeywords").val());keyword=CtoH(keyword);autoComplateFun(keyword)}return false});$(document).click(function(){resultBox.hide();resultListCurrentIndex=-1;var e=e||window.event||arguments.callee.caller.arguments[0];var target=e.target||e.srcElement;if($(target).attr("id")=="rec_results"||$(target).parents("#rec_results").length==1){return}$("#rec_results").hide()})};function getSearchList(){var _hostName=document.location.hostname;var ego_reg=/list(pre|sit|dev|)(.cn|.)suning.com$/;if(ego_reg.test(_hostName)){return true}return false}var cutString=function(str,len){if(str.length*2<=len){return str}var strlen=0;var s="";for(var i=0;i<str.length;i++){s=s+str.charAt(i);if(str.charCodeAt(i)>128){strlen=strlen+2;if(strlen>=len){return s.substring(0,s.length-1)+"..."}}else{strlen=strlen+1;if(strlen>=len){return s.substring(0,s.length-2)+"..."}}}return s};function getCategoryId(){var categoryId="0";var urlForSug=window.location.href.substring(window.location.href.lastIndexOf("/"));if(sn.catalogId=="22001"||window.location.href.match("(.*?10052_22001.*?)")){if(sn.pgFlag=="22001_4"){categoryId=sn.searchCategoryId}else{if(sn.pgFlag=="22001_1"){categoryId="1"}else{if(sn.pgFlag=="22001_2"){categoryId=sn.searchCategoryId}else{categoryId="1"}}}if(categoryId=="undefined"){categoryId="1"}if(getSearchList()||urlForSug.match("(^/trd.do)")){categoryId=sn.categoryId}return categoryId}if(getSearchList()){return sn.categoryId}if(null!=urlForSug&&""!=urlForSug){var urlForSugTmp=urlForSug.match("/[A-Za-z]+");if(null!=urlForSugTmp&&urlForSugTmp[0].match("(^/strd$)|(^/sprd$)|(^/prd$)|(^/ProductDisplay$)|(^/cd$)|(^/pcd$)|(^/wine$)|(^/spbf$)")){if(urlForSugTmp[0].match("(^/strd$)|(^/cd$)|(^/spbf$)")){categoryId=sn.categoryId}else{if(urlForSugTmp[0].match("(^/wine$)")){categoryId="0"}else{if(urlForSugTmp[0].match("(^/pcd$)")){categoryId="0"}else{if(urlForSugTmp[0].match("(^/prd$)")||urlForSugTmp[0].match("(^/sprd$)")){categoryId=sn.categoryId}else{categoryId=sn.categoryId}}}}}else{if(typeof(sn.pgFlag)!="undefined"&&null!=sn.pgFlag){if(sn.pgFlag=="10051_2"){categoryId=sn.categoryId}else{if(sn.pgFlag=="10051_2.5"){categoryId="0"}else{if(sn.pgFlag=="10051_4"){categoryId=sn.categoryId}}}}else{if(window.location.href.match("(.*?redbaby.*?)")!=null||window.location.href.match("(.*?14655.*?)")!=null||window.location.href.match("(.*?mysec.*?)")!=null||window.location.href.match("(.*?mytop.*?)")!=null||window.location.href.match("(.*?guide.*?)")!=null){categoryId="2"}else{if(window.location.href.match("(.*?binggo.*?)")!=null||window.location.href.match("(.*?14656.*?)")!=null||window.location.href.match("(.*?mztop.*?)")!=null||window.location.href.match("(.*?mzsec.*?)")!=null){categoryId="3"}else{if(window.location.href.match("(.*?dianqicheng.*?)")!=null){categoryId="22005"}else{if(null!=urlForSugTmp&&urlForSugTmp[0].match("(^/brandhome$)|(^/brand$)")||(window.location.href.match("(.*?brand.*?)")!=null)){categoryId="0"}else{if(sn.categoryId=="10051"){categoryId="0"}else{categoryId=sn.categoryId}}}}}}}}if(categoryId=="undefined"){categoryId="0"}categoryId=getSearchChannel(categoryId);return categoryId}function getSearchCategoryId(){var categoryId="0";if(sn.catalogId=="22001"||window.location.href.match("(.*?10052_22001.*?)")){categoryId="1";return categoryId}var urlForSug=window.location.href.substring(window.location.href.lastIndexOf("/"));if(null!=urlForSug&&""!=urlForSug){var urlForSugTmp=urlForSug.match("/[A-Za-z]+");if(null!=urlForSugTmp&&urlForSugTmp[0].match("(^/strd$)|(^/sprd$)|(^/prd$)|(^/ProductDisplay$)|(^/cd$)|(^/pcd$)|(^/wine$)")){if(sn.searchCatalogId=="14655"){categoryId="2"}else{if(sn.searchCatalogId=="14656"){categoryId="3"}else{categoryId="0"}}}else{if(typeof(sn.pgFlag)!="undefined"&&null!=sn.pgFlag){if(sn.searchCatalogId=="14655"){categoryId="2"}else{if(sn.searchCatalogId=="14656"){categoryId="3"}else{categoryId="0"}}}else{if(window.location.href.match("(.*?redbaby.*?)")!=null||window.location.href.match("(.*?14655.*?)")!=null||window.location.href.match("(.*?mysec.*?)")!=null||window.location.href.match("(.*?mytop.*?)")!=null||window.location.href.match("(.*?fashion.*?)")!=null||window.location.href.match("(.*?guide.*?)")!=null){categoryId="2"}else{if(window.location.href.match("(.*?binggo.*?)")!=null||window.location.href.match("(.*?14656.*?)")!=null||window.location.href.match("(.*?mztop.*?)")!=null||window.location.href.match("(.*?mzsec.*?)")!=null){categoryId="3"
}else{if((null!=urlForSugTmp&&urlForSugTmp[0].match("(^/tcd$)"))||(urlForSug=="/")){categoryId="0"}else{if(null!=urlForSugTmp&&urlForSugTmp[0].match("(^/brandhome$)|(^/brand$)")||(window.location.href.match("(.*?brand.*?)")!=null)){categoryId="0"}else{categoryId="0"}}}}}}}if(categoryId=="undefined"){categoryId="0"}categoryId=getSearchChannel(categoryId);return categoryId}function getSearchChannel(categoryId){if(categoryId=="0"&&typeof param!="undefined"){if(param.searchType=="10"){categoryId="2"}else{if(param.searchType=="12"){categoryId="3"}}}return categoryId}var setUrl=function(tmp){var url=sn.searchDomain.replace("emall/","")+encodeURIComponent(resolveStr(tmp))+"/";if(sn.searchCatalogId=="22001"){url=sn.searchDomain+"bookSearch.do?keyword="+encodeURIComponent(tmp);if($("#bookSearchChannel").length>0){url+=$("#bookSearchChannel").attr("value")}}if(sn.searchCatalogId=="14655"){url+="&ch=1"}if(sn.searchCatalogId=="14656"){url+="&ch=2"}if(typeof param!="undefined"){if(param.searchType=="10"){url+="&ch=1"}else{if(param.searchType=="12"){url+="&ch=2"}}}return url};var onSubmitSearch=function(){var channelName=$("#g_static_channel_name").val();if(channelName=="snbook"){var snbooktmp=$.trim($("#searchKeywords").val());if(snbooktmp==""){obj.focus();return false}var url=sn.searchDomain.replace("emall/","")+"web/search.do?keywords="+encodeURIComponent(resolveStr(snbooktmp));window.location.href=url;return false}var obj,tmp;if(searchFlag){obj=$("#searchKeywords");tmp=$.trim(obj.val())}else{if($("#searchKeywords").val()==="输入关键字搜索商品/品牌/店铺"){return false}obj=$("#searchDefaultKeyword");tmp=$.trim(obj.attr("key"))}if(tmp==""){obj.focus()}else{tmp=CtoH(tmp);var url=sn.searchDomain.replace("emall/","")+encodeURIComponent(resolveStr(tmp))+"/";if(sn.searchCatalogId=="22001"){url=sn.searchDomain+"bookSearch.do?keyword="+encodeURIComponent(tmp);if($("#bookSearchChannel").length>0){url+=$("#bookSearchChannel").attr("value")}}if(sn.searchCatalogId=="14655"){url+="&ch=1"}if(sn.searchCatalogId=="14656"){url+="&ch=2"}if(typeof searchCatalogId!="undefined"&&searchCatalogId!=""&&searchCatalogId!=false){url+="&ci="+searchCatalogId}if(searchStoreFlag){url=sn.searchDomain.replace("emall/","")+"shop/search.do?app=shopsearch&keyword="+encodeURIComponent(tmp)}if(typeof param!="undefined"){if(param.searchType=="10"){url+="&ch=1"}else{if(param.searchType=="12"){url+="&ch=2"}}}try{var RSC=$(".g-ac-store").find("em").eq(0).text();var LXC=assWord;var name="public0_"+LXC;var nameAndIndex=RSC+"_"+search_da_djc_index;var manual="";if(ismanual=="1"){manual="-01"}if(nameType=="hotword"){name+="-01-1_"+nameAndIndex+manual}else{if(nameType=="category"){name+="-01-2_"+nameAndIndex+manual}else{if(nameType=="history"){name+="-02_"+nameAndIndex}else{if(nameType=="store"){name+="-03_"+nameAndIndex}else{if(nameType=="brandshop"){name="public0_"+RSC+"-04_"+assWord+"_1"}else{name="public0_"+nameAndIndex}}}}}var dom=$('<a href="###" name="'+name+'"></a>')[0];if("undefined"!=typeof sa&&"undefined"!=typeof sa.click){sa.click.sendDatasIndex(dom)}}catch(e){}if(nameType=="brandshop"){nameType="";return false}window.location.href=url}return false};function httpGifSendIndex(a){var n="hislog_"+(new Date()).getTime();var i=window[n]=new Image();i.onload=(i.onerror=function(){window[n]=null});i.src=a+"?"+n;i=null}function resolveStr(str){str=str.replace(/\-/g,"%2d");str=str.replace(/\&/g,"%26");str=str.replace(/\./g,"%2E");str=str.replace(/\+/g,"%2B");return str}function resolveHisKey(str){str=str.replace(/\%/g,"%25").replace(/\-/g,"%2d").replace(/\+/g,"%2B").replace(/\;/g,"%3B").replace(/\:/g,"%3A").replace(/\?/g,"%3F");return str}function CtoH(val){var str=val;var result="";for(var i=0;i<str.length;i++){if(str.charCodeAt(i)==12288){result+=String.fromCharCode(str.charCodeAt(i)-12256);continue}if(str.charCodeAt(i)>65280&&str.charCodeAt(i)<65375){result+=String.fromCharCode(str.charCodeAt(i)-65248)}else{result+=String.fromCharCode(str.charCodeAt(i))}}return result}function keyDown(){$(document).keydown(function(e){var tagName=document.activeElement.tagName;if((e.keyCode==83&&tagName=="BODY"||tagName=="HTML")){$("#searchKeywords").focus();if(e&&e.preventDefault){e.preventDefault()}else{window.event.returnValue=false}return false}if(e.keyCode==27){$("#ac_results").hide();$("#rec_results").hide();$("#searchKeywords").blur()}})}var searchEvent=function(){getSearchKeyword();searchAutoComplete();searchInputEvent();keyDown()};var clearBox=function(){$("#ac_results").hide();$("#rec_results").hide()};var searchIptBlur=function(){$("#searchKeywords").blur()};var outerAction=function(){if(typeof SnSidebar!="undefined"){SnSidebar.hide()}};return{onSubmitSearch:onSubmitSearch,searchEvent:searchEvent,cancelbtnEvent:cancelbtnEvent,clearBox:clearBox,searchIptBlur:searchIptBlur}})(jQuery);